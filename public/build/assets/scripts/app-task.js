define(["http://res.wx.qq.com/open/js/jweixin-1.0.0.js",AvalonLibsBaseUrl+"mmState","./lib/http/http"],function(wx){var illy_domain="http://testweixin.hizuoye.com",illy_images_base_src="./assets/images",apiBaseUrl="http://testapi.hizuoye.com/api/v1/",token=localStorage.getItem("illy-token"),global_viewload_animation_name="a-bounceinR",global_always_show_loader=!0,global_always_reset_scrollbar=!0,global_loading_timeout=12e3,global_loading_delay=300,global_loader_className=".loader",global_loader_dom=document.querySelector(".loader"),global_errorLog_style="background-color: red; color: #fff; padding: 3px; border-radius: 3px",global_warningLog_style="background-color: #ff9100; color: #fff; padding: 3px; border-radius: 3px",global_infoLog_style="background-color: #14e5d5; color: #fff; padding: 3px; border-radius: 3px",global_recordLog_style="background-color: #64c400; color: #fff; padding: 3px; border-radius: 3px";avalon.getVM=function(vm){return avalon.vmodels[vm]},avalon.getPureModel=function(vm){return avalon.vmodels&&avalon.vmodels[vm]&&avalon.vmodels[vm].$model},avalon.$=function(selector){return document.querySelector(selector)};var illyLog=function(type,msg,res,style,saveToLocalStorage){var root=avalon.vmodels.root,namespace=root.namespace,currentVM=root.currentState;res=res||"","string"!=typeof res&&(res=JSON.stringify(res)),console.log("%c"+type.toUpperCase()+": "+namespace+" -> "+currentVM+": "+msg+res,style),saveToLocalStorage&&localStorage.setItem("illy-record-"+namespace+"-"+currentVM+"-"+Date.now(),msg+" "+res)};avalon.illyWarning=function(msg,res){illyLog("warning",msg,res,global_warningLog_style,!1)},avalon.illyError=function(msg,res){illyLog("error",msg,res,global_errorLog_style,!1)},avalon.illyInfo=function(msg,res){illyLog("info",msg,res,global_infoLog_style,!1)},avalon.illyRecord=function(msg,res){illyLog("record",msg,res,global_recordLog_style,!0)},avalon.illyProfile=function(){var performance=window.performance;if(!performance)return void console.error("你的浏览器不支持 performance 接口");var t=performance.timing,times={};return times.loadPage=t.loadEventEnd-t.navigationStart,times.domReady=t.domComplete-t.responseEnd,times.redirect=t.redirectEnd-t.redirectStart,times.lookupDomain=t.domainLookupEnd-t.domainLookupStart,times.ttfb=t.responseStart-t.navigationStart,times.request=t.responseEnd-t.requestStart,times.loadEvent=t.loadEventEnd-t.loadEventStart,times.appcache=t.domainLookupStart-t.fetchStart,times.unloadEvent=t.unloadEventEnd-t.unloadEventStart,times.connect=t.connectEnd-t.connectStart,times};var getLocalCache=function(itemName){return localStorage.getItem&&JSON.parse(""+localStorage.getItem(itemName))},setLocalCache=function(itemName,source){source=JSON.stringify(source),localStorage.setItem&&localStorage.setItem(itemName,source)},clearLocalCache=function(prefix){for(var key in localStorage)key.indexOf(prefix)>=0&&localStorage.removeItem(key)};avalon.getLocalCache=getLocalCache,avalon.setLocalCache=setLocalCache,avalon.clearLocalCache=clearLocalCache,null===token&&(alert("对不起，本系统仅供内部使用！ ERROR::no token error!"),setTimeout(function(){wx.closeWindow()},3e3)),avalon.illyGlobal={viewani:global_viewload_animation_name,token:token,apiBaseUrl:apiBaseUrl,illyDomain:illy_domain,imagesBaseSrc:illy_images_base_src};var root=avalon.define({$id:"root",namespace:"task",currentState:"",currentAction:"",currentIsVisited:!1,title:"",footerInfo:"",back:function(){history.go(-1)}});root.$watch("currentAction",function(currentAction){if(void 0!==currentAction)switch(currentAction){case"onError":avalon.log("Error!, Redirect to index!",arguments),avalon.router.go("task.list");break;case"onBegin":break;case"onLoad":break;case"onBeforeUnload":break;case"onUnload":}});var loadingBeginHandler=function(loader,callback){"function"==typeof loader&&(callback=loader,loader=void 0),loader=global_loader_dom||document.querySelector(global_loader_className);var showLoader=function(){loader&&(loader.style.display="")},always_show_loader=global_always_show_loader===!0?!0:!1;loader&&always_show_loader?showLoader():!loader||always_show_loader||root.currentIsVisited||showLoader(),callback&&"function"==typeof callback&&callback()},loadingEndHandler=function(loader,callback){"function"==typeof loader&&(callback=loader,loader=void 0),loader=global_loader_dom||document.querySelector(global_loader_className);var hideLoader=function(){loader&&(loader.style.display="none")};void 0===global_loading_delay&&(global_loading_delay=500,console.log("%cWARNING: no global_loading_delay set!","background-color: red; color: #fff")),setTimeout(function(){hideLoader(),callback&&"function"==typeof callback&&callback()},global_loading_delay)};root.$watch("currentAction",function(currentAction){"onBegin"===currentAction&&loadingBeginHandler(),"onLoad"===currentAction&&loadingEndHandler()});var bindBadNetworkHandler=function(timeout){timeout=global_loading_timeout||8e3;var loader=global_loader_dom||document.querySelector(global_loader_className);badNetworkTimer&&clearTimeout(badNetworkTimer);var badNetworkTimer=setTimeout(function(){alert("对不起，您的网络状态暂时不佳，请稍后重试！"),history.go(-1),loader&&(loader.style.display="none")},timeout);avalon.badNetworkTimer=badNetworkTimer,root.$watch("currentState",function(changeState){void 0!==changeState&&clearTimeout(badNetworkTimer)})},unbindBadNetworkHandler=function(timer){timer=timer||avalon.badNetworkTimer,timer&&clearTimeout(timer)};root.$watch("currentAction",function(currentAction){"onBegin"===currentAction&&bindBadNetworkHandler(),"onLoad"===currentAction&&unbindBadNetworkHandler()});var getCurrentState=function(){var state1=mmState.currentState.stateName.split(".")[1],state2=mmState.currentState.stateName.split(".")[2];return void 0===state2?state1:state2};root.$watch("currentAction",function(currentAction){"onLoad"===currentAction&&(root.currentState=getCurrentState())});var setPageTitle=function(titleMap){titleMap=titleMap||ACTIONBAR_TITLE_MAP;var currentState=root.currentState;root.title=titleMap[currentState]};root.$watch("currentAction",function(currentAction){"onLoad"===currentAction&&setPageTitle()});var doIsVisitedCheck=function(cacheContainer,callback){"function"==typeof cacheContainer&&(callback=cacheContainer,cacheContainer=void 0);var pageId=location.href.split("!")[1];cacheContainer=cacheContainer||CACHE_VISITED_PAGEID_CONTAINER,cacheContainer.push(pageId);for(var isVisited=!1,i=0,len=CACHE_VISITED_PAGEID_CONTAINER.length-1;len>i;i++)CACHE_VISITED_PAGEID_CONTAINER[i]===pageId&&(isVisited=!0);return callback&&"function"==typeof callback&&callback(),isVisited},CACHE_VISITED_PAGEID_CONTAINER=[];root.$watch("currentAction",function(currentAction){"onBegin"===currentAction&&(root.currentIsVisited=doIsVisitedCheck())});var resetScrollbarWhenViewLoaded=function(){document.body.scrollTop=0,document.documentElement.scrollTop=0};global_always_reset_scrollbar===!0&&root.$watch("currentAction",function(currentAction){"onLoad"===currentAction&&resetScrollbarWhenViewLoaded()}),avalon.wx=wx;var uri=location.href.split("#")[0],url=encodeURIComponent(uri);$http.ajax({url:"http://api.hizuoye.com/api/v1/public/sdk/signature",data:{url:url},success:function(jsonobj){var appId=jsonobj.appid,timestamp=jsonobj.timestamp,nonceStr=jsonobj.nonceStr,signature=jsonobj.signature;wx.config({debug:!1,appId:appId,timestamp:timestamp,nonceStr:nonceStr,signature:signature,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","hideMenuItems","showMenuItems","hideAllNonBaseMenuItem","showAllNonBaseMenuItem","translateVoice","startRecord","stopRecord","onRecordEnd","playVoice","pauseVoice","stopVoice","uploadVoice","downloadVoice","chooseImage","previewImage","uploadImage","downloadImage","getNetworkType","openLocation","getLocation","hideOptionMenu","showOptionMenu","closeWindow","scanQRCode","chooseWXPay","openProductSpecificView","addCard","chooseCard","openCard"]})},error:function(res){console.log("wx ajax error"+res)},ajaxFail:function(res){console.log("wx ajaxFail"+res)}}),wx.error(function(res){alert("Woops, error comes..."+res)});var ACTIONBAR_TITLE_MAP={list:"任务列表",rank:"排行榜",mall:"积分商城",article:"活动详情",activity:"活动详情",me:"个人中心"};return avalon.state("task",{url:"/","abstract":!0,views:{"":{templateUrl:"assets/templates/task/task.html",controllerUrl:"scripts/controller/task/task.js"},"footer@":{templateUrl:"assets/templates/footer.html"}}}).state("task.taskList",{url:"",views:{"":{templateUrl:"assets/templates/task/taskList.html",controllerUrl:"scripts/controller/task/taskList.js"}}}).state("task.detail",{"abstract":!0,views:{"":{templateUrl:"assets/templates/task/detail.html",controllerUrl:"scripts/controller/task/detail.js"}}}).state("task.detail.article",{url:"article/{taskId}/score/{scoreAward}",views:{"":{templateUrl:"assets/templates/task/article.html",controllerUrl:"scripts/controller/task/article.js"}}}).state("task.detail.activity",{url:"activity/{taskId}/score/{scoreAward}",views:{"":{templateUrl:"assets/templates/task/activity.html",controllerUrl:"scripts/controller/task/activity.js"}}}).state("task.rank",{url:"rank",views:{"":{templateUrl:"assets/templates/task/rank.html",controllerUrl:"scripts/controller/task/rank.js"}}}).state("task.mall",{url:"mall",views:{"":{templateUrl:"assets/templates/task/mall.html",controllerUrl:"scripts/controller/task/mall.js"}}}).state("task.me",{url:"me",views:{"":{templateUrl:"assets/templates/task/me.html",controllerUrl:"scripts/controller/task/me.js"}}}),avalon.state.config({onError:function(){root.currentAction="onError"},onBeforeUnload:function(){root.currentAction="onBeforeUnload"},onUnload:function(){root.currentAction="onUnload"},onBegin:function(){root.currentAction="onBegin"},onLoad:function(){root.currentAction="onLoad"}}),{init:function(){avalon.log("init to bootstrap the app!"),avalon.history.start({fireAnchor:!1}),avalon.scan(),avalon.appInitTime=Date.now()}}});
//# sourceMappingURL=app-task.js.map