!function(gmu,$){gmu.Refresh.register("iOS5",{_init:function(){var me=this,opts=me._options,$el=me.$el;$el.css({overflow:"scroll","-webkit-overflow-scrolling":"touch"}),opts.topOffset=opts.$upElem?opts.$upElem.height():0,opts.iScroll=me._getiScroll(),$el.get(0).scrollTop=opts.topOffset,$el.on("touchstart touchmove touchend",$.proxy(me._eventHandler,me))},_changeStyle:function(dir,state){var me=this,opts=me._options,refreshInfo=opts.refreshInfo[dir];switch(me.origin(dir,state),state){case"loaded":refreshInfo.$icon.addClass("ui-refresh-icon"),opts._actDir="";break;case"beforeload":refreshInfo.$label.html("松开立即加载"),refreshInfo.$icon.addClass("ui-refresh-flip");break;case"loading":refreshInfo.$icon.removeClass().addClass("ui-loading")}return me},_scrollStart:function(e){var me=this,opts=me._options,topOffset=opts.topOffset,$upElem=opts.$upElem,wrapper=me.$el.get(0),_scrollFn=function(){clearTimeout(opts.topOffsetTimer),$upElem&&$upElem.length&&wrapper.scrollTop<=topOffset&&!opts._upRefreshed&&(wrapper.scrollTop=topOffset)};return me.trigger("scrollstart",e),me._enableScroll()._bindScrollStop(wrapper,_scrollFn),opts.maxScrollY=wrapper.offsetHeight-wrapper.scrollHeight,opts._scrollFn=_scrollFn,me},_scrollMove:function(){var me=this,opts=me._options,up=opts.$upElem&&opts.$upElem.length,down=opts.$downElem&&opts.$downElem.length,wrapper=me.$el.get(0),threshold=opts.threshold||5;me._scrollMove=function(e){var maxScrollY=opts.maxScrollY,scrollY=wrapper.scrollTop,lastMoveY=opts.lastMoveY||scrollY,upRefreshed=opts._upRefreshed,downRefreshed=opts._downRefreshed,upStatus=me._status("up"),downStatus=me._status("down");if(!(up&&!upStatus||down&&!downStatus))return opts.iScroll.deltaY=scrollY-lastMoveY,downStatus&&down&&!downRefreshed&&maxScrollY-threshold>-scrollY?me._setMoveState("down","beforeload","pull"):downStatus&&down&&downRefreshed&&-scrollY>maxScrollY-threshold&&-scrollY!==maxScrollY?me._setMoveState("down","loaded","restore"):upStatus&&up&&!upRefreshed&&-scrollY>threshold?me._setMoveState("up","beforeload","pull"):upStatus&&up&&upRefreshed&&threshold>-scrollY&&scrollY&&me._setMoveState("up","loaded","restore"),opts.lastMoveY=scrollY,opts._moved=!0,me.trigger("scrollmove",e,scrollY,scrollY-lastMoveY)},me._scrollMove.apply(me,arguments)},_scrollEnd:function(e){var me=this,opts=me._options,wrapper=me.$el.get(0),topOffset=opts.topOffset,actDir=opts._actDir,restoreDir=opts._restoreDir;return("up"==restoreDir||wrapper.scrollTop<=topOffset)&&!actDir&&opts._moved&&(me._options.topOffsetTimer=setTimeout(function(){$(wrapper).off("scroll",opts._scrollFn),wrapper.scrollTop=topOffset},800)),actDir&&me._status(actDir)&&(me._setStyle(actDir,"loading"),me._loadingAction(actDir,"pull")),opts._moved=!1,me.trigger("scrollend",e)},_enableScroll:function(){var me=this,wrapper=me.$el.get(0),scrollY=wrapper.scrollTop;return 0>=scrollY&&(wrapper.scrollTop=1),scrollY+wrapper.offsetHeight>=wrapper.scrollHeight&&(wrapper.scrollTop=wrapper.scrollHeight-wrapper.offsetHeight-1),me},_bindScrollStop:function(elem,fn){var me=this,$elem=$(elem);return $elem.off("scroll",me._options._scrollFn).on("scroll",$.debounce(100,function(){$elem.off("scroll",arguments.callee).one("scroll",fn)},!1)),me},_getiScroll:function(){var me=this,$wrapper=me.$el,wrapper=$wrapper[0];return{el:wrapper,deltaY:0,scrollTo:function(y,time,relative){relative&&(y=wrapper.scrollTop+y),$wrapper.css({"-webkit-transition-property":"scrollTop","-webkit-transition-duration":y+"ms"}),wrapper.scrollTop=y},disable:function(destroy){destroy&&me.destroy(),$wrapper.css("overflow","hidden")},enable:function(){$wrapper.css("overflow","scroll")}}},_setMoveState:function(dir,state,actType){var me=this,opts=me._options;return me._setStyle(dir,state),opts["_"+dir+"Refreshed"]="pull"==actType,opts._actDir="pull"==actType?dir:"",opts._restoreDir="up"==dir&&"restore"==actType?dir:"",me},_eventHandler:function(e){var me=this;switch(e.type){case"touchstart":me._scrollStart(e);break;case"touchmove":me._scrollMove(e);break;case"touchend":me._scrollEnd(e)}},afterDataLoading:function(dir){var me=this,opts=me._options,dir=dir||opts._actDir;return opts["_"+dir+"Refreshed"]=!1,"up"==dir&&(me.$el.get(0).scrollTop=opts.topOffset),me.origin(dir)}})}(gmu,gmu.$);
//# sourceMappingURL=%24iOS5.js.map