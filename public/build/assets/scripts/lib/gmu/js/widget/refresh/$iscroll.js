!function(gmu,$){gmu.Refresh.register("iscroll",{_init:function(){var me=this,opts=me._options,$el=me.$el,wrapperH=$el.height();$.extend(opts,{useTransition:!0,speedScale:1,topOffset:opts.$upElem?opts.$upElem.height():0}),opts.threshold=opts.threshold||5,$el.wrapAll($('<div class="ui-refresh-wrapper"></div>').height(wrapperH)).css("height","auto"),me.on("ready",function(){me._loadIscroll()})},_changeStyle:function(dir,state){var me=this,opts=me._options,refreshInfo=opts.refreshInfo[dir];switch(me.origin(dir,state),state){case"loaded":refreshInfo.$icon.addClass("ui-refresh-icon");break;case"beforeload":refreshInfo.$label.html("松开立即加载"),refreshInfo.$icon.addClass("ui-refresh-flip");break;case"loading":refreshInfo.$icon.removeClass().addClass("ui-loading")}return me},_loadIscroll:function(){var me=this,opts=me._options,threshold=opts.threshold;opts.iScroll=new iScroll(me.$el.parent().get(0),opts.iScrollOpts=$.extend({useTransition:opts.useTransition,speedScale:opts.speedScale,topOffset:opts.topOffset},opts.iScrollOpts,{onScrollStart:function(e){me.trigger("scrollstart",e)},onScrollMove:function(){var up=opts.$upElem&&opts.$upElem.length,down=opts.$downElem&&opts.$downElem.length;return function(e){var upRefreshed=opts._upRefreshed,downRefreshed=opts._downRefreshed,upStatus=me._status("up"),downStatus=me._status("down");up&&!upStatus||down&&!downStatus||this.maxScrollY>=0||(downStatus&&down&&!downRefreshed&&this.y<this.maxScrollY-threshold?me._setMoveState("down","beforeload","pull"):upStatus&&up&&!upRefreshed&&this.y>threshold?(me._setMoveState("up","beforeload","pull"),this.minScrollY=0):downStatus&&downRefreshed&&this.y>this.maxScrollY+threshold?me._setMoveState("down","loaded","restore"):upStatus&&upRefreshed&&this.y<threshold&&(me._setMoveState("up","loaded","restore"),this.minScrollY=-opts.topOffset),me.trigger("scrollmove",e))}}(),onScrollEnd:function(e){var actDir=opts._actDir;actDir&&me._status(actDir)&&(me._setStyle(actDir,"loading"),me._loadingAction(actDir,"pull")),me.trigger("scrollend",e)}}))},_setMoveState:function(dir,state,actType){var me=this,opts=me._options;return me._setStyle(dir,state),opts["_"+dir+"Refreshed"]="pull"==actType,opts._actDir="pull"==actType?dir:"",me},afterDataLoading:function(dir){var me=this,opts=me._options,dir=dir||opts._actDir;return opts.iScroll.refresh(),opts["_"+dir+"Refreshed"]=!1,me.origin(dir)}})}(gmu,gmu.$);
//# sourceMappingURL=%24iscroll.js.map