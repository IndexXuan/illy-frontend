!function($,win){var guid=0;gmu.define("Suggestion",{options:{historyShare:!0,confirmClearHistory:!0,autoClose:!1},template:{wrapper:'<div class="ui-suggestion"><div class="ui-suggestion-content"></div><div class="ui-suggestion-button"><span class="ui-suggestion-clear">清除历史记录</span><span class="ui-suggestion-close">关闭</span></div></div>'},_initDom:function(){var me=this,$input=me.getEl().attr("autocomplete","off"),$parent=$input.parent(".ui-suggestion-mask");return $parent.length?me.$mask=$parent:$input.wrap(me.$mask=$('<div class="ui-suggestion-mask"></div>')),me.$mask.append(me.tpl2html("wrapper")),me.$wrapper=me.$mask.find(".ui-suggestion").prop("id","ui-suggestion-"+guid++),me.$content=me.$wrapper.css("top",$input.height()+(me.wrapperTop=parseInt(me.$wrapper.css("top"),10)||0)).find(".ui-suggestion-content"),me.$btn=me.$wrapper.find(".ui-suggestion-button"),me.$clearBtn=me.$btn.find(".ui-suggestion-clear"),me.$closeBtn=me.$btn.find(".ui-suggestion-close"),me.trigger("initdom")},_bindEvent:function(){var me=this,$el=me.getEl(),ns=me.eventNs;return me._options.autoClose&&$(document).on("tap"+ns,function(e){!$.contains(me.$mask.get(0),e.target)&&me.hide()}),$el.on("focus"+ns,function(){!me.isShow&&me._showList().trigger("open")}),$el.on("input"+ns,function(){me._showList()}),me.$clearBtn.on("click"+ns,function(){me.history(null)}).highlight("ui-suggestion-highlight"),me.$closeBtn.on("click"+ns,function(){me.getEl().blur(),me.hide().trigger("close")}).highlight("ui-suggestion-highlight"),me},_create:function(){var me=this,opts=me._options,hs=opts.historyShare;return opts.container&&(me.$el=$(opts.container)),me.key=hs?("boolean"===$.type(hs)?"":hs+"-")+"SUG-Sharing-History":me.getEl().attr("id")||"ui-suggestion-"+guid++,me.separator=encodeURIComponent(","),me._initDom()._bindEvent(),me},_showList:function(){var data,me=this,query=me.value();return query?me.trigger("sendrequest",query,$.proxy(me._render,me),$.proxy(me._cacheData,me)):(data=me._localStorage())?me._render(query,data.split(me.separator)):me.hide(),me},_render:function(query,data){this.trigger("renderlist",data,query,$.proxy(this._fillWrapper,this))},_fillWrapper:function(listHtml){return this.$clearBtn[this.value()?"hide":"show"](),listHtml?(this.$content.html(listHtml),this.show()):this.hide(),this},_localStorage:function(value){var localStorage,data,me=this,key=me.key,separator=me.separator;try{if(localStorage=win.localStorage,void 0===value)return localStorage[key];null===value?localStorage[key]="":value&&(data=localStorage[key]?localStorage[key].split(separator):[],~$.inArray(value,data)||(data.unshift(value),localStorage[key]=data.join(separator)))}catch(ex){console.log(ex.message)}return me},_cacheData:function(key,value){return this.cacheData||(this.cacheData={}),void 0!==value?this.cacheData[key]=value:this.cacheData[key]},value:function(){return this.getEl().val()},history:function(value){var me=this,clearHistory=null!==value||function(){return me._localStorage(null).hide()};return null===value?me._options.confirmClearHistory?win.confirm("清除全部查询历史记录？")&&clearHistory():clearHistory():me._localStorage(value)},show:function(){return this.isShow?this:(this.$wrapper.show(),this.isShow=!0,this.trigger("show"))},hide:function(){return this.isShow?(this.$wrapper.hide(),this.isShow=!1,this.trigger("hide")):this},destroy:function(){var me=this,$el=me.getEl(),ns=me.ns;return me.trigger("destroy"),$el.off(ns),me.$mask.replaceWith($el),me.$clearBtn.off(ns),me.$closeBtn.off(ns),me.$wrapper.children().off().remove(),me.$wrapper.remove(),me._options.autoClose&&$(document).off(ns),this.destroyed=!0,me}})}(gmu.$,window);
//# sourceMappingURL=suggestion.js.map