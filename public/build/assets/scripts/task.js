define(["http://res.wx.qq.com/open/js/jweixin-1.0.0.js",AvalonLibsBaseUrl+"mmState","./lib/http/http"],function(wx){var illy_domain="http://app.hizuoye.com/",illy_images_base=illy_domain+"assets/images";avalon.wx=wx;var global_loading_timeout=5,acTitle={list:"任务列表",rank:"排行榜",mall:"积分商城",article:"活动详情",activity:"活动详情",me:"个人中心"},handleBadNetwork=function(delay){delay=1e3*global_loading_timeout||8e3;var loader=document.querySelector(".loader"),badNetworkTimer=setTimeout(function(){alert("对不起，您的网络状态暂时不佳，请稍后重试！"),history.go(-1),loader&&(loader.style.display="none")},delay);avalon.badNetworkTimer=badNetworkTimer},g_viewload_animation="a-bounceinR",token=localStorage.getItem("illy-token"),apiBaseUrl="http://101.201.176.191/api/v1/";avalon.illyGlobal={viewani:g_viewload_animation,token:token,apiBaseUrl:apiBaseUrl,imagesBaseSrc:illy_images_base},avalon.getVM=function(vm){return avalon.vmodels[vm]},avalon.getPureModel=function(vm){return avalon.vmodels&&avalon.vmodels[vm]&&avalon.vmodels[vm].$model},avalon.$=function(selector){return document.querySelector(selector)};var clearLocalCache=function(prefix){for(var key in localStorage)key.indexOf(prefix)>=0&&localStorage.removeItem(key)},setLocalCache=function(itemName,source){source=JSON.stringify(source),localStorage.setItem&&localStorage.setItem(itemName,source)},getLocalCache=function(itemName){return localStorage.getItem&&JSON.parse(""+localStorage.getItem(itemName))};avalon.clearLocalCache=clearLocalCache,avalon.setLocalCache=setLocalCache,avalon.getLocalCache=getLocalCache;var uri=location.href.split("#")[0],url=encodeURIComponent(uri);$http.ajax({method:"",url:"http://api.hizuoye.com/api/v1/public/sdk/signature",data:{url:url},success:function(jsonobj){var appId=jsonobj.appid,timestamp=jsonobj.timestamp,nonceStr=jsonobj.nonceStr,signature=jsonobj.signature;wx.config({debug:!1,appId:appId,timestamp:timestamp,nonceStr:nonceStr,signature:signature,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","hideMenuItems","showMenuItems","hideAllNonBaseMenuItem","showAllNonBaseMenuItem","translateVoice","startRecord","stopRecord","onRecordEnd","playVoice","pauseVoice","stopVoice","uploadVoice","downloadVoice","chooseImage","previewImage","uploadImage","downloadImage","getNetworkType","openLocation","getLocation","hideOptionMenu","showOptionMenu","closeWindow","scanQRCode","chooseWXPay","openProductSpecificView","addCard","chooseCard","openCard"]})},error:function(res){console.log("wx ajax error"+res)},ajaxFail:function(res){console.log("wx ajaxFail"+res)}}),wx.ready(function(){}),wx.error(function(res){alert("Woops, error comes when WeChat-sdk signature..."+res)});var root=avalon.define({$id:"root",currentPage:"",currentIsVisited:!1,title:"",footerInfo:"",back:function(){history.go(-1)}});avalon.state("task",{url:"/","abstract":!0,views:{"":{templateUrl:"assets/template/task/task.html",controllerUrl:"scripts/controller/task/task.js"},"footer@":{templateUrl:"assets/template/footer.html"}}}).state("task.list",{url:"",views:{"":{templateUrl:"assets/template/task/list.html",controllerUrl:"scripts/controller/task/list.js"}}}).state("task.detail",{"abstract":!0,views:{"":{templateUrl:"assets/template/task/detail.html",controllerUrl:"scripts/controller/task/detail.js"}}}).state("task.detail.article",{url:"article/{taskId}/score/{scoreAward}",views:{"":{templateUrl:"assets/template/task/article.html",controllerUrl:"scripts/controller/task/article.js"}}}).state("task.detail.activity",{url:"activity/{taskId}/score/{scoreAward}",views:{"":{templateUrl:"assets/template/task/activity.html",controllerUrl:"scripts/controller/task/activity.js"}}}).state("task.detail.staticActivity",{url:"staticActivity/{taskId}",views:{"":{templateUrl:"assets/template/task/static-activity.html",controllerUrl:"scripts/controller/task/static-activity.js"}}}).state("task.rank",{url:"rank",views:{"":{templateUrl:"assets/template/task/rank.html",controllerUrl:"scripts/controller/task/rank.js"}}}).state("task.mall",{url:"mall",views:{"":{templateUrl:"assets/template/task/mall.html",controllerUrl:"scripts/controller/task/mall.js"}}}).state("task.me",{url:"me",views:{"":{templateUrl:"assets/template/task/me.html",controllerUrl:"scripts/controller/task/me.js"}}});var cache=[];return avalon.state.config({onError:function(){avalon.log("Error!, Redirect to index!",arguments),avalon.router.go("site.index")},onBeforeUnload:function(){},onUnload:function(){},onBegin:function(){var pageId=location.href.split("!")[1];cache.push(pageId);for(var loader=document.querySelector(".loader"),visited=!1,curid=location.href.split("!")[1],i=0,len=cache.length-1;len>i;i++)cache[i]===curid&&(visited=!0);loader&&!visited&&(loader.style.display="",handleBadNetwork()),root.currentIsVisited=visited},onLoad:function(){document.body.scrollTop=0,document.documentElement.scrollTop=0;var state=mmState.currentState.stateName.split("."),state1=state[1],state2=state[2];void 0!==state2&&(state1=state2),root.currentPage=state1,root.title=acTitle[state1];var loader=document.querySelector(".loader");setTimeout(function(){loader&&(loader.style.display="none"),avalon.badNetworkTimer&&clearTimeout(avalon.badNetworkTimer)},200);var view=document.querySelector("[avalonctrl="+root.currentPage+"]");view&&view.classList.add(g_viewload_animation)},onViewEnter:function(){}}),{init:function(){avalon.log("init to rendered the page"),avalon.history.start({fireAnchor:!1}),avalon.scan()}}});
//# sourceMappingURL=task.js.map