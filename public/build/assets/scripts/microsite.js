define(["http://res.wx.qq.com/open/js/jweixin-1.0.0.js",AvalonLibsBaseUrl+"mmState","./lib/http/http"],function(wx){var illy_domain="http://app.hizuoye.com",illy_images_base=illy_domain+"/assets/images";avalon.wx=wx;var apiBaseUrl="http://101.201.176.191/api/v1/",token=localStorage.getItem("illy-token-microsite")||localStorage.getItem("illy-token"),g_viewload_animation="a-bounceinR",global_loading_timeout=8,global_loading_duration=500;avalon.illyGlobal={viewani:g_viewload_animation,token:token,apiBaseUrl:apiBaseUrl,illyDomain:illy_domain,imagesBaseSrc:illy_images_base,noTokenHandler:function(){alert("对不起，本系统仅供内部使用！")}},avalon.getVM=function(vm){return avalon.vmodels[vm]},avalon.getPureModel=function(vm){return avalon.vmodels&&avalon.vmodels[vm]&&avalon.vmodels[vm].$model},avalon.$=function(selector){return document.querySelector(selector)};var clearLocalCache=function(prefix){for(var key in localStorage)key.indexOf(prefix)>=0&&localStorage.removeItem(key)},setLocalCache=function(itemName,source){source=JSON.stringify(source),localStorage.setItem&&localStorage.setItem(itemName,source)},getLocalCache=function(itemName){return localStorage.getItem&&JSON.parse(""+localStorage.getItem(itemName))};avalon.clearLocalCache=clearLocalCache,avalon.setLocalCache=setLocalCache,avalon.getLocalCache=getLocalCache;var acTitle={index:"首页",list:"文章列表",detail:"内容详情"},handleBadNetwork=function(delay){delay=1e3*global_loading_timeout||8e3;var loader=document.querySelector(".loader"),badNetworkTimer=setTimeout(function(){alert("对不起，您的网络状态暂时不佳，请稍后重试！"),history.go(-1),loader&&(loader.style.display="none")},delay);avalon.badNetworkTimer=badNetworkTimer},uri=location.href.split("#")[0],url=encodeURIComponent(uri);$http.ajax({method:"",url:"http://api.hizuoye.com/api/v1/public/sdk/signature",data:{url:url},success:function(jsonobj){var appId=jsonobj.appid,timestamp=jsonobj.timestamp,nonceStr=jsonobj.nonceStr,signature=jsonobj.signature;wx.config({debug:!1,appId:appId,timestamp:timestamp,nonceStr:nonceStr,signature:signature,jsApiList:["checkJsApi","onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ","onMenuShareWeibo","hideMenuItems","showMenuItems","hideAllNonBaseMenuItem","showAllNonBaseMenuItem","translateVoice","startRecord","stopRecord","onRecordEnd","playVoice","pauseVoice","stopVoice","uploadVoice","downloadVoice","chooseImage","previewImage","uploadImage","downloadImage","getNetworkType","openLocation","getLocation","hideOptionMenu","showOptionMenu","closeWindow","scanQRCode","chooseWXPay","openProductSpecificView","addCard","chooseCard","openCard"]})},error:function(res){console.log("wx ajax error"+res)},ajaxFail:function(res){console.log("wx ajaxFail"+res)}}),wx.error(function(res){alert("Woops, error comes when WeChat-sdk signature..."+res)});var root=avalon.define({$id:"root",currentPage:"",currentIsVisited:!1,title:"",footerInfo:"kuando Inc",back:function(){history.go(-1)}});avalon.state("site",{url:"/","abstract":!0,views:{"":{templateUrl:"assets/templates/microsite/site.html",controllerUrl:"scripts/controller/microsite/site.js"},"footer@":{templateUrl:"assets/templates/footer.html"}}}).state("site.index",{url:"",views:{"":{templateUrl:"assets/templates/microsite/index.html",controllerUrl:"scripts/controller/microsite/index.js",viewCache:!0}}}).state("site.list",{url:"{categoryId}",views:{"":{templateUrl:"assets/templates/microsite/list.html",controllerUrl:"scripts/controller/microsite/list.js"}}}).state("site.detail",{url:"detail/{articleId}",views:{"":{templateUrl:"assets/templates/microsite/detail.html",controllerUrl:"scripts/controller/microsite/detail.js"}}});var cache=[];return avalon.state.config({onError:function(){avalon.log("Error!, Redirect to index!",arguments),avalon.router.go("/")},onBeforeUnload:function(){},onUnload:function(){},onBegin:function(){var pageId=location.href.split("!")[1];cache.push(pageId);for(var loader=document.querySelector(".loader"),visited=!1,curid=location.href.split("!")[1],i=0,len=cache.length-1;len>i;i++)cache[i]===curid&&(visited=!0);loader&&!visited&&(loader.style.display="",handleBadNetwork()),root.currentIsVisited=visited},onLoad:function(){document.body.scrollTop=0,document.documentElement.scrollTop=0,root.currentPage=mmState.currentState.stateName.split(".")[1];var state=root.currentPage;root.title=acTitle[state],setTimeout(function(){var loader=document.querySelector(".loader");loader&&(loader.style.display="none"),avalon.badNetworkTimer&&clearTimeout(avalon.badNetworkTimer)},global_loading_duration)},onViewEnter:function(){}}),{init:function(){avalon.log("init to rendered the page"),avalon.history.start({fireAnchor:!1}),avalon.scan()}}});
//# sourceMappingURL=microsite.js.map