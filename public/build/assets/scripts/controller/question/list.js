define([],function(){var apiBaseUrl=avalon.illyGlobal.apiBaseUrl,token=avalon.illyGlobal.token,localLimit=6,list=avalon.define({$id:"list",isVisited:!1,noContent:!1,noContentText:"还没有做过作业哦，<br/>快去完成作业，得到老师评价吧~",defaultQuestionImage:"../assets/images/iconfont-questionImage.png",lists:[],isLoading:!1,offset:0,noMoreData:!1,btnShowMore:!1,fetchData:function(data,concat){list.isLoading=!0;var offset,limit=localLimit;offset=list.lists.length||0,$http.ajax({url:apiBaseUrl+"questions?state=0&limit="+limit+"&offset="+offset,data:data,headers:{Authorization:"Bearer "+token},dataType:"json",success:function(lists){list.lists=concat===!0?list.lists.concat(lists):lists,setTimeout(function(){var newLists=list.lists;newLists&&0===newLists.length&&(list.noContent=!0)},200),0===lists.length&&(list.noMoreData=!0),list.isLoading=!1},error:function(res){avalon.illyError("list ajax error",res),list.lists.length<=1&&(list.noContent=!0)},ajaxFail:function(res){avalon.illyError("list ajax failed"+res),list.lists.length<=1&&(list.noContent=!0)}})},showMore:function(e){e.preventDefault(),list.fetchData({},!0)},deleteQuestion:function(questionId){$http.ajax({method:"DELETE",url:apiBaseUrl+"questions/"+questionId,headers:{Authorization:"Bearer "+token},dataType:"json",success:function(){list.lists.forEach(function(item,i){item._id===questionId&&list.lists.splice(i,1)})},error:function(res){avalon.illyError("question delete ajax error",res)},ajaxFail:function(res){avalon.illyError("question delete ajax failed"+res)}})}});return list.lists.$watch("length",function(newLength){list.btnShowMore=newLength&&localLimit>newLength?!1:!0}),avalon.controller(function($ctrl){$ctrl.$onBeforeUnload=function(){},$ctrl.$onEnter=function(){avalon.vmodels.result.current="list",list.isVisited=avalon.vmodels.root.currentIsVisited,list.isVisited||list.fetchData()},$ctrl.$onRendered=function(){!function(){var startX,throttle=function(func,wait,options){var context,args,result,timeout=null,previous=0;options||(options={});var later=function(){previous=options.leading===!1?0:Date.now(),timeout=null,result=func.apply(context,args),timeout||(context=args=null)};return function(){var now=Date.now();previous||options.leading!==!1||(previous=now);var remaining=wait-(now-previous);return context=this,args=arguments,0>=remaining||remaining>wait?(clearTimeout(timeout),timeout=null,previous=now,result=func.apply(context,args),timeout||(context=args=null)):timeout||options.trailing===!1||(timeout=setTimeout(later,remaining)),result}},viewWidth=$(window).width(),wrapper=".J-list-wrapper",touchTarget=".ui-layer",maxMoveX=viewWidth/4,canMoveAreaX=viewWidth/5;$(wrapper).on("touchstart",touchTarget,function(e){startX=e.touches[0].pageX});var moveDelta,moveX,endX,moveDirection;$(wrapper).on("touchmove",touchTarget,function(e){var self=$(this),pageX=e.touches[0].pageX;return endX=pageX,moveDelta=pageX-startX,moveDirection=0>moveDelta?"left":"right",canMoveAreaX>startX?void e.preventDefault():swipeLeftDone===!1&&"right"===moveDirection?void e.preventDefault():swipeLeftDone===!0&&"left"===moveDirection?void e.preventDefault():(0>moveDelta&&maxMoveX>moveDelta?moveX=moveDelta:0>moveDelta&&moveDelta>=maxMoveX&&(moveX=maxMoveX),void throttle(function(){self.css("-webkit-transform","translateX("+moveX+"px)")},66))});var swipeLeftDone=!1;$(wrapper).on("touchend",touchTarget,function(){endX>0&&startX>endX&&Math.abs(moveDelta)>30?($(this).css("-webkit-transform","translateX("+-maxMoveX+"px)"),swipeLeftDone=!0):endX>0&&endX>startX&&moveDelta>40?($(this).css("-webkit-transform","translateX(0px)"),swipeLeftDone=!1):swipeLeftDone===!1&&$(this).click()})}(),$(".J-list-wrapper").on("click",".fn-layer",function(){var questionId=$(this).attr("data-questionid");list.deleteQuestion(questionId),$(this).hide()})},$ctrl.$vmodels=[]})});
//# sourceMappingURL=list.js.map