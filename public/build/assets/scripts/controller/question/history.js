define([],function(){var apiBaseUrl=avalon.illyGlobal.apiBaseUrl,token=avalon.illyGlobal.token,cachedPrefix="illy-question-history-",needCache=!0,localLimit=6,history=avalon.define({$id:"history",visited:!1,historys:[],offset:0,noContent:!1,isLoading:!1,noMoreData:!1,btnShowMore:!1,fetchRemoteData:function(apiArgs,data,target,concat){if(4!==arguments.length&&avalon.illyError("ERROR: must give 4 args!"+arguments),history.noMoreData=!1,history.visited&&needCache&&!concat){var articles=history.historys;return history.historys=avalon.getLocalCache(cachedPrefix+history.categoryId+"-"+target),avalon.vmodels.root.currentRendered=!0,history.offset=history.historys.length,void(articles.length>localLimit&&articles.length%localLimit<localLimit&&(history.noMoreData=!0))}history.isLoading=!0,$http.ajax({url:apiBaseUrl+apiArgs,headers:{Authorization:"Bearer "+token},data:data,success:function(res){history.historys=concat===!0?history.historys.concat(res):res,0===res.length&&(history.noMoreData=!0),history.offset=history.historys.length,0===history.historys.length&&(history.noContent=!0,history.noMoreData=!0);var result=history.historys.$model;avalon.setLocalCache(cachedPrefix+history.categoryId+"-"+target,result),history.isLoading=!1,avalon.vmodels.root.currentRendered=!0},error:function(res){avalon.illyError("microsite history.js ajax error",res),0===history.historys.length&&(history.noContent=!0),history.isLoading=!1},ajaxFail:function(res){avalon.illyError("microsite history.js ajax failed",res),0===history.historys.length&&(history.noContent=!0),history.isLoading=!1}})},showMore:function(e){e.preventDefault(),history.fetchRemoteData("categories/"+history.categoryId+"/posts",{limit:localLimit,offset:history.offset},"historys",!0)}});return history.historys.$watch("length",function(newhistorys){void 0!==newhistorys&&(localLimit>newhistorys?history.btnShowMore=!1:"hots"!==history.categoryId&&(history.btnShowMore=!0))}),avalon.controller(function($ctrl){$ctrl.$onBeforeUnload=function(){},$ctrl.$onEnter=function(){avalon.vmodels.result.current="history",history.visited=avalon.vmodels.root.currentIsVisited},$ctrl.$onRendered=function(){},$ctrl.$vmodels=[]})});
//# sourceMappingURL=history.js.map