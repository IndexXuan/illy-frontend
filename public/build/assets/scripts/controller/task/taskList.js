define([],function(){var apiBaseUrl=avalon.illyGlobal.apiBaseUrl,token=avalon.illyGlobal.token;null===token&&avalon.illyGlobal.noTokenHandler();var resourcePrefix="http://resource.hizuoye.com/",defaultAvatarUrl="http://resource.hizuoye.com/images/avatar/children/default1.png?image";if(!token)return void alert("no token error");var limit=6,taskList=avalon.define({$id:"taskList",noContent:!1,lists:[],avatar:"",studentCount:"",visited:!1,offset:0,btnShowMore:!0,goRank:function(){avalon.router.go("task.rank")},goMe:function(){avalon.router.go("task.me")},fetchData:function(data,concat){$http.ajax({method:"",url:apiBaseUrl+"tasks",data:data,headers:{Authorization:"Bearer "+token},success:function(lists){concat?taskList.lists.concat(lists):taskList.lists=lists,setTimeout(function(){var newLists=taskList.lists;newLists&&0===newLists.length&&(taskList.noContent=!0)},500)},error:function(res){avalon.illyError("ajax error",res)},ajaxFail:function(res){avalon.illyError("ajax failed",res)}})},showMore:function(e){e.preventDefault();var page=2;return taskList.offset<limit?void(taskList.btnShowMore=!1):(taskList.offset=taskList.offset+limit*(page-1),void taskList.fetchRemoteData({offset:taskList.offset},"concat"))},taskTypeMap:{0:"article",1:"activity"},goSpecTask:function(){var taskType=arguments[0].getAttribute("data-tasktype"),taskId=arguments[0].getAttribute("data-taskid"),taskScoreAward=arguments[0].getAttribute("data-taskscoreaward"),state="task.detail."+taskList.taskTypeMap[taskType];avalon.router.go(state,{taskId:taskId,scoreAward:taskScoreAward})}});return avalon.controller(function($ctrl){$ctrl.$onBeforeUnload=function(){},$ctrl.$onEnter=function(){avalon.vmodels.task.$watch("score",function(newVal){(void 0!==newVal||""!==newVal)&&(taskList.avatar=resourcePrefix+avalon.vmodels.task.avatar+"?imageView2/1/w/200/h/200"||defaultAvatarUrl,taskList.studentCount=avalon.vmodels.task.studentCount||100,taskList.score=avalon.vmodels.task.score)}),taskList.visited=avalon.vmodels.root.currentIsVisited,taskList.btnShowMore=taskList.offset<=limit?!1:!0,taskList.fetchData()},$ctrl.$onRendered=function(){},$ctrl.$vmodels=[]})});
//# sourceMappingURL=taskList.js.map