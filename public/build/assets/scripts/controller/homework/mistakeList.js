define([],function(){var apiBaseUrl=avalon.illyGlobal&&avalon.illyGlobal.apiBaseUrl,token=avalon.illyGlobal.token;null===token&&avalon.vmodels.root.noTokenHandler();var localLimit=6,mistakeList=avalon.define({$id:"mistakeList",isVisited:!1,noMistakeListContent:!1,noContentText:"恭喜你！小学霸。暂时没有错题集，咱们继续努力，再接再厉吧~",lists:[],isLoading:!1,isRecover:!1,offset:0,noMoreData:!1,btnShowMore:!1,fetchData:function(limit,offset,showMore){mistakeList.isLoading=!0,limit=limit||localLimit,offset=mistakeList.offset,mistakeList.isVisited&&!mistakeList.isRecover&&(offset=localStorage.getItem("illy-homework-mistakeList-offset"),0!==offset&&offset>=mistakeList.offset&&(limit=offset,offset=0,mistakeList.isRecover=!0)),$http.ajax({method:"",url:apiBaseUrl+"homework/mistake?limit="+limit+"&offset="+offset,headers:{Authorization:"Bearer "+token},success:function(res){mistakeList.lists=showMore===!0&&res.length<=localLimit?mistakeList.lists.concat(res):res,localStorage.setItem("illy-homework-mistakeList-offset",mistakeList.lists.length),mistakeList.offset=mistakeList.lists.length,setTimeout(function(){var newLists=mistakeList.lists;newLists&&0===newLists.length&&(mistakeList.noMistakeListContent=!0)},200),0===res.length&&(mistakeList.noMoreData=!0),mistakeList.isLoading=!1},error:function(res){console.log("mistakeList ajax error"+res),mistakeList.noMistakeListContent=!0,mistakeList.isLoading=!1},ajaxFail:function(res){console.log("mistakeList ajax failed"+res),mistakeList.noMistakeListContent=!0,mistakeList.isLoading=!1}})},showMore:function(e){e.preventDefault();var offset=mistakeList.offset;mistakeList.fetchData(localLimit,offset,!0)},fetchDataForExercises:function(homeworkId){$http.ajax({url:apiBaseUrl+"homework/mistake/"+homeworkId,headers:{Authorization:"Bearer "+token},success:function(res){var mistake=avalon.vmodels.mistake;mistake.exercises=res,avalon.router.go("app.mistake.wrong",{homeworkId:homeworkId,questionId:1})},error:function(res){console.log("mistakeTemp ajax error"+res)},ajaxFail:function(res){console.log("mistakeTemp ajax failed"+res)}})},goWrong:function(){var homeworkId=arguments[0].getAttribute("data-homeworkId");mistakeList.fetchDataForExercises(homeworkId)}});return mistakeList.lists.$watch("length",function(newLength){mistakeList.btnShowMore=newLength&&localLimit>newLength?!1:!0}),avalon.controller(function($ctrl){$ctrl.$onBeforeUnload=function(){mistakeList.isRecover=!1},$ctrl.$onEnter=function(){mistakeList.isVisited=avalon.vmodels.root.currentIsVisited,mistakeList.fetchData()},$ctrl.$onRendered=function(){},$ctrl.$vmodels=[]})});
//# sourceMappingURL=mistakeList.js.map